"use strict";const t=require("../../common/vendor.js");let e,a,r=t.index.getSystemInfoSync(),o=r.screenWidth;r.pixelRatio;let c,i,s,p,g,n,h,d,u,m=100,v=r.screenWidth;const l={data:()=>({name:"杨大宝",imageSrc:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-dc-site/b31d90c0-5168-11eb-bdc1-8bd33eb6adaa.jpg",isShowImg:!1,cropperInitW:o,cropperInitH:o,cropperW:o,cropperH:o,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:o,cutR:"100%",qualityWidth:v,innerAspectRadio:1}),onLoad:function(t){},onReady:function(){this.loadImage()},methods:{setData:function(t){let e=this;Object.keys(t).forEach((function(a){e.$set(e.$data,a,t[a])}))},getImage:function(){var e=this;t.index.chooseImage({success:function(t){e.setData({imageSrc:t.tempFilePaths[0]}),e.loadImage()}})},loadImage:function(){var e=this;t.index.showLoading({title:"图片加载中..."}),t.index.getImageInfo({src:e.imageSrc,success:function(a){h=a.width/a.height,h>=1?(d=o,u=o/h):(d=o*h,u=o);let r=d>u?d:u;if(m=r>m?m:r,h>=1){let t=Math.ceil((o/h-(o/h-m))/2),a=t,r=Math.ceil((o-o+m)/2),c=r;e.setData({cropperW:o,cropperH:o/h,cropperL:Math.ceil((o-o)/2),cropperT:Math.ceil((o-o/h)/2),cutL:r,cutT:t,cutR:c,cutB:a,imageW:d,imageH:u,scaleP:d/o,qualityWidth:v,innerAspectRadio:h})}else{let t=Math.ceil((o*h-o*h)/2),a=t,r=Math.ceil((o-m)/2),c=r;e.setData({cropperW:o*h,cropperH:o,cropperL:Math.ceil((o-o*h)/2),cropperT:Math.ceil((o-o)/2),cutL:t,cutT:r,cutR:a,cutB:c,imageW:d,imageH:u,scaleP:d/o,qualityWidth:v,innerAspectRadio:h})}e.setData({isShowImg:!0}),t.index.hideLoading()}})},contentStartMove(t){e=t.touches[0].pageX,a=t.touches[0].pageY},contentMoveing(t){var r=1*(e-t.touches[0].pageX),o=1*(a-t.touches[0].pageY);r>0?this.cutL-r<0&&(r=this.cutL):this.cutR+r<0&&(r=-this.cutR),o>0?this.cutT-o<0&&(o=this.cutT):this.cutB+o<0&&(o=-this.cutB),this.setData({cutL:this.cutL-r,cutT:this.cutT-o,cutR:this.cutR+r,cutB:this.cutB+o}),e=t.touches[0].pageX,a=t.touches[0].pageY},contentTouchEnd(){},getImageInfo(){var e=this;t.index.showLoading({title:"图片生成中..."});const a=t.index.createCanvasContext("myCanvas");a.drawImage(e.imageSrc,0,0,d,u),a.draw(!0,(()=>{var a=(e.cropperW-e.cutL-e.cutR)/e.cropperW*d,r=(e.cropperH-e.cutT-e.cutB)/e.cropperH*u,o=e.cutL/e.cropperW*d,c=e.cutT/e.cropperH*u;t.index.canvasToTempFilePath({x:o,y:c,width:a,height:r,destWidth:a,destHeight:r,quality:.5,canvasId:"myCanvas",success:function(e){t.index.hideLoading(),t.index.previewImage({current:"",urls:[e.tempFilePath]})}})}))},dragStart(t){c=t.touches[0].pageX,i=t.touches[0].pageY,s=this.cutL,g=this.cutR,n=this.cutB,p=this.cutT},dragMove(t){switch(t.target.dataset.drag){case"right":var e=1*(c-t.touches[0].pageX);g+e<0&&(e=-g),this.setData({cutR:g+e});break;case"left":e=1*(c-t.touches[0].pageX);s-e<0&&(e=s),s-e>this.cropperW-this.cutR&&(e=s-(this.cropperW-this.cutR)),this.setData({cutL:s-e});break;case"top":e=1*(i-t.touches[0].pageY);p-e<0&&(e=p),p-e>this.cropperH-this.cutB&&(e=p-(this.cropperH-this.cutB)),this.setData({cutT:p-e});break;case"bottom":e=1*(i-t.touches[0].pageY);n+e<0&&(e=-n),this.setData({cutB:n+e});break;case"rightBottom":var a=1*(c-t.touches[0].pageX),r=1*(i-t.touches[0].pageY);n+r<0&&(r=-n),g+a<0&&(a=-g);let o=n+r,h=g+a;this.setData({cutB:o,cutR:h})}}}};if(!Array){t.resolveComponent("page-foot")()}const x=t._export_sfc(l,[["render",function(e,a,r,o,c,i){return t.e({a:c.isShowImg},c.isShowImg?{b:c.imageSrc,c:t.s("width:"+c.cropperW+"px;height:"+c.cropperH+"px"),d:t.o(((...t)=>i.dragStart&&i.dragStart(...t))),e:t.o(((...t)=>i.dragMove&&i.dragMove(...t))),f:t.o(((...t)=>i.dragStart&&i.dragStart(...t))),g:t.o(((...t)=>i.dragMove&&i.dragMove(...t))),h:t.o(((...t)=>i.dragStart&&i.dragStart(...t))),i:t.o(((...t)=>i.dragMove&&i.dragMove(...t))),j:t.o(((...t)=>i.dragStart&&i.dragStart(...t))),k:t.o(((...t)=>i.dragMove&&i.dragMove(...t))),l:t.o(((...t)=>i.dragStart&&i.dragStart(...t))),m:t.o(((...t)=>i.dragMove&&i.dragMove(...t))),n:t.o(((...t)=>i.dragStart&&i.dragStart(...t))),o:t.o(((...t)=>i.dragMove&&i.dragMove(...t))),p:t.o(((...t)=>i.dragStart&&i.dragStart(...t))),q:t.o(((...t)=>i.dragMove&&i.dragMove(...t))),r:t.o(((...t)=>i.dragStart&&i.dragStart(...t))),s:t.o(((...t)=>i.dragMove&&i.dragMove(...t))),t:t.o(((...t)=>e.dragEnd&&e.dragEnd(...t))),v:t.o(((...t)=>i.dragStart&&i.dragStart(...t))),w:t.o(((...t)=>i.dragMove&&i.dragMove(...t))),x:t.o(((...t)=>i.contentStartMove&&i.contentStartMove(...t))),y:t.o(((...t)=>i.contentMoveing&&i.contentMoveing(...t))),z:t.o(((...t)=>i.contentTouchEnd&&i.contentTouchEnd(...t))),A:t.s("left:"+c.cutL+"px;top:"+c.cutT+"px;right:"+c.cutR+"px;bottom:"+c.cutB+"px"),B:t.s("width:"+c.cropperW+"px;height:"+c.cropperH+"px;left:"+c.cropperL+"px;top:"+c.cropperT+"px"),C:t.s("width:"+c.cropperInitW+"px;height:"+c.cropperInitH+"px;background:#000")}:{},{D:t.o(((...t)=>i.getImage&&i.getImage(...t))),E:t.o(((...t)=>i.getImageInfo&&i.getImageInfo(...t))),F:t.s("position:absolute;border: 1px solid red; width:"+c.imageW+"px;height:"+c.imageH+"px;top:-9999px;left:-9999px;"),G:t.p({name:c.name})})}]]);wx.createPage(x);
